.TH SPI 3 "2025" "SPI Library" "Library Functions Manual"
.SH NAME
spi \- hardware SPI library for embedded systems
.SH SYNOPSIS
.B #include <spi.h>
.PP
.B void spi_init(uint8_t divisor, uint8_t cpol, uint8_t cpha);
.br
.B void spi_set_divisor(uint8_t divisor);
.br
.B void spi_set_mode(uint8_t cpol, uint8_t cpha);
.br
.B void spi_cs_low(void);
.br
.B void spi_cs_high(void);
.br
.B uint8_t spi_calculate_divisor(uint16_t frequency_khz);
.br
.B void spi_set_frequency_khz(uint16_t frequency);
.br
.B uint8_t spi_transfer(uint8_t data);
.SH DESCRIPTION
The SPI library provides hardware SPI (Serial Peripheral Interface) functionality with configurable clock speed, modes, and chip select control.
.PP
.B spi_init()
initializes the SPI interface with the specified clock divisor, clock polarity (cpol), and clock phase (cpha).
.PP
.B spi_set_divisor()
sets the SPI clock divisor directly.
.PP
.B spi_set_mode()
configures SPI mode using clock polarity and phase settings.
.PP
.B spi_cs_low()
asserts the chip select signal (active low).
.PP
.B spi_cs_high()
deasserts the chip select signal.
.PP
.B spi_calculate_divisor()
calculates the appropriate clock divisor for the specified frequency in kHz.
.PP
.B spi_set_frequency_khz()
sets the SPI clock frequency in kHz.
.PP
.B spi_transfer()
performs a full-duplex SPI transfer, sending one byte and returning the received byte.
.SH RETURN VALUES
.B spi_transfer()
returns the byte received during the transfer.
.PP
.B spi_calculate_divisor()
returns the calculated clock divisor value.
.PP
Other functions do not return values.
.SH SPI MODES
The SPI mode is determined by clock polarity (cpol) and clock phase (cpha):
.PP
.RS
Mode 0: cpol=0, cpha=0
.br
Mode 1: cpol=0, cpha=1
.br
Mode 2: cpol=1, cpha=0
.br
Mode 3: cpol=1, cpha=1
.RE
.SH EXAMPLES
.PP
Basic SPI communication:
.PP
.RS
.nf
spi_init(8, 0, 0);     // Initialize, divisor=8, mode 0
spi_cs_low();          // Select device
data = spi_transfer(0xFF);  // Send/receive byte
spi_cs_high();         // Deselect device
.fi
.RE
.PP
Set frequency:
.PP
.RS
.nf
spi_set_frequency_khz(1000);  // Set to 1MHz
.fi
.RE
.SH NOTES
SPI transfers are full-duplex. Always control chip select manually. Use frequency functions for precise timing control.
.SH SEE ALSO
.BR timer (3)
